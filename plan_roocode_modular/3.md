# Step 3: File Management

## Objective

Implement the file management component of the RooCode modular system. This component will:
- Save the user question to question.md
- Save the prompt to outline.md if provided
- Copy specified files to the experiment folder

## File Management Design

### Question File Management

We'll implement a function to:
1. Create question.md in the experiment folder
2. Write the user question text to the file
3. Handle potential errors (e.g., permission issues, disk space)

### Prompt File Management

We'll implement a function to:
1. Check if a prompt was provided
2. If provided, create outline.md in the experiment folder
3. Write the prompt text to the file
4. Handle potential errors

### File Copying

We'll implement a function to:
1. Parse the list of source:destination file pairs
2. For each pair:
   - Verify the source file exists
   - Create the destination directory if it doesn't exist
   - Copy the file to the destination
   - Handle potential errors

## Implementation

We'll extend the `roocode-modular.sh` script with the following functions:

```bash
# Function to save user question to question.md
function save_question {
  local expt_dir="${PYTHON_DIR}/${EXPT}"
  local question_file="${expt_dir}/question.md"
  
  echo "Saving user question to ${question_file}..."
  
  # Create the file and write the question
  echo "${QUESTION}" > "${question_file}"
  
  # Check if the file was created successfully
  if [ $? -ne 0 ]; then
    echo "Error: Failed to save question to ${question_file}"
    exit 1
  fi
  
  echo "Question saved successfully."
}

# Function to save prompt to outline.md if provided
function save_prompt {
  # Skip if no prompt was provided
  if [ -z "${PROMPT}" ]; then
    echo "No prompt provided, skipping outline.md creation."
    return 0
  fi
  
  local expt_dir="${PYTHON_DIR}/${EXPT}"
  local outline_file="${expt_dir}/outline.md"
  
  echo "Saving prompt to ${outline_file}..."
  
  # Create the file and write the prompt
  echo "${PROMPT}" > "${outline_file}"
  
  # Check if the file was created successfully
  if [ $? -ne 0 ]; then
    echo "Error: Failed to save prompt to ${outline_file}"
    exit 1
  fi
  
  echo "Prompt saved successfully."
}

# Function to copy specified files
function copy_files {
  # Skip if no files were specified
  if [ -z "${FILES}" ]; then
    echo "No files specified, skipping file copying."
    return 0
  fi
  
  local expt_dir="${PYTHON_DIR}/${EXPT}"
  
  echo "Copying specified files to ${expt_dir}..."
  
  # Split the comma-separated list of file pairs
  IFS=',' read -ra FILE_PAIRS <<< "${FILES}"
  
  for pair in "${FILE_PAIRS[@]}"; do
    # Split the source:destination pair
    IFS=':' read -ra PARTS <<< "${pair}"
    
    if [ ${#PARTS[@]} -ne 2 ]; then
      echo "Error: Invalid file pair format: ${pair}"
      echo "Expected format: source:destination"
      exit 1
    fi
    
    local source="${PARTS[0]}"
    local destination="${PARTS[1]}"
    
    # Verify the source file exists
    if [ ! -f "${source}" ]; then
      echo "Error: Source file does not exist: ${source}"
      exit 1
    fi
    
    # Create the destination directory if it doesn't exist
    local dest_dir="${expt_dir}"
    if [ -n "${destination}" ]; then
      dest_dir="${expt_dir}/${destination}"
      mkdir -p "${dest_dir}"
    fi
    
    # Copy the file
    cp "${source}" "${dest_dir}/"
    
    # Check if the copy was successful
    if [ $? -ne 0 ]; then
      echo "Error: Failed to copy ${source} to ${dest_dir}/"
      exit 1
    fi
    
    echo "Copied ${source} to ${dest_dir}/"
  done
  
  echo "All files copied successfully."
}
```

We'll update the `main` function to call these new functions:

```bash
# Main function
function main {
  parse_arguments "$@"
  validate_inputs
  manage_experiment_folder
  save_question
  save_prompt
  copy_files
  
  # Placeholder for future components
  echo "File management completed successfully."
}
```

## Testing

We'll create a test script called `test-file-management.sh` that:
1. Tests saving questions of various lengths to question.md
2. Tests saving prompts of various lengths to outline.md
3. Tests copying files with various source:destination combinations
4. Tests error handling for invalid inputs
5. Verifies that all files are created and copied correctly

## Next Steps

In the next step, we'll implement the git operations component, which will:
- Remove the remote for /home/ubuntu/LaunchRoo/evals if it exists
- Keep the git checkout main operation
- Update the local main branch with created files
- Create a new branch during workflow execution
- Commit changes to the new branch

We'll build on the file management component implemented in this step.